<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Generate Audio File</h6>
            </div>
            <div class="card-body">
                <form id="audioForm">
                    <div class="mb-3">
                        <label for="fileName" class="form-label">File Name (without extension)</label>
                        <input type="text" class="form-control" id="fileName" name="fileName" required 
                               placeholder="e.g., spanish_phrase_001">
                        <div class="form-text">The audio file will be saved with this name and the selected format extension.</div>
                    </div>

                    <div class="mb-3">
                        <label for="text" class="form-label">Text to Convert to Audio</label>
                        <textarea class="form-control" id="text" name="text" rows="4" required 
                                  placeholder="Enter the text you want to convert to audio..."></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="voice" class="form-label">Voice</label>
                                <select class="form-select" id="voice" name="voice">
                                    <option value="alloy">Alloy</option>
                                    <option value="echo">Echo</option>
                                    <option value="fable">Fable</option>
                                    <option value="onyx">Onyx</option>
                                    <option value="nova">Nova</option>
                                    <option value="shimmer">Shimmer</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="format" class="form-label">Format</label>
                                <select class="form-select" id="format" name="format">
                                    <option value="mp3">MP3</option>
                                    <option value="wav">WAV</option>
                                    <option value="flac">FLAC</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary" id="generateBtn">
                            <i class="fas fa-music me-2"></i>Generate Audio
                        </button>
                    </div>
                </form>

                <!-- Loading indicator -->
                <div id="loadingIndicator" class="text-center mt-3" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Generating audio...</span>
                    </div>
                    <p class="mt-2">Generating audio file, please wait...</p>
                </div>

                <!-- Result section -->
                <div id="resultSection" class="mt-4" style="display: none;">
                    <div class="alert alert-success" role="alert">
                        <h5 class="alert-heading">Audio Generated Successfully!</h5>
                        <p id="resultMessage"></p>
                        <hr>
                        <div id="audioPlayer" class="mt-3"></div>
                        <div class="mt-3">
                            <a id="downloadLink" href="#" class="btn btn-success me-2" download>
                                <i class="fas fa-download me-2"></i>Download Audio File
                            </a>
                            <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                                <i class="fas fa-plus me-2"></i>Generate Another
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Error section -->
                <div id="errorSection" class="mt-4" style="display: none;">
                    <div class="alert alert-danger" role="alert">
                        <h5 class="alert-heading">Error Generating Audio</h5>
                        <p id="errorMessage"></p>
                        <hr>
                        <button type="button" class="btn btn-outline-danger" onclick="hideError()">
                            <i class="fas fa-times me-2"></i>Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('audioForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    // Show loading indicator
    document.getElementById('loadingIndicator').style.display = 'block';
    document.getElementById('resultSection').style.display = 'none';
    document.getElementById('errorSection').style.display = 'none';
    document.getElementById('generateBtn').disabled = true;
    
    try {
        const response = await fetch('/admin/audio/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Show success result
            document.getElementById('resultMessage').textContent = result.message;
            document.getElementById('downloadLink').href = result.filePath;
            document.getElementById('downloadLink').download = result.fileName;
            
            // Create audio player
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.innerHTML = `
                <audio controls class="w-100">
                    <source src="${result.filePath}" type="audio/${data.format}">
                    Your browser does not support the audio element.
                </audio>
            `;
            
            document.getElementById('resultSection').style.display = 'block';
        } else {
            // Show error
            document.getElementById('errorMessage').textContent = result.error;
            document.getElementById('errorSection').style.display = 'block';
        }
    } catch (error) {
        // Show error
        document.getElementById('errorMessage').textContent = 'An unexpected error occurred. Please try again.';
        document.getElementById('errorSection').style.display = 'block';
    } finally {
        // Hide loading indicator
        document.getElementById('loadingIndicator').style.display = 'none';
        document.getElementById('generateBtn').disabled = false;
    }
});

function resetForm() {
    document.getElementById('audioForm').reset();
    document.getElementById('resultSection').style.display = 'none';
    document.getElementById('errorSection').style.display = 'none';
}

function hideError() {
    document.getElementById('errorSection').style.display = 'none';
}
</script>
